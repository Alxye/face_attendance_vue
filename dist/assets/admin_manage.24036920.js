import{d as D,o as f,q as h,b as s,j as y,O as H,_ as S,r as c,c as F,w as d,e as $,t as w,m as P,P as M,D as U,L as j,h as I,Q as q,S as G,F as z,v as L,k as B,K as J,a as C,M as K,E,T as Q}from"./index.2c3d48fc.js";import{b as R}from"./corporation.c59b6f0c.js";import{s as W,h as O}from"./loading.ebf062c3.js";import{g as X}from"./department.d24309c9.js";var A=D({name:"Delete"});const Y={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},Z=s("path",{fill:"currentColor",d:"M160 256H96a32 32 0 0 1 0-64h256V95.936a32 32 0 0 1 32-32h256a32 32 0 0 1 32 32V192h256a32 32 0 1 1 0 64h-64v672a32 32 0 0 1-32 32H192a32 32 0 0 1-32-32V256zm448-64v-64H416v64h192zM224 896h576V256H224v640zm192-128a32 32 0 0 1-32-32V416a32 32 0 0 1 64 0v320a32 32 0 0 1-32 32zm192 0a32 32 0 0 1-32-32V416a32 32 0 0 1 64 0v320a32 32 0 0 1-32 32z"},null,-1);function x(e,a,r,l,m,i){return f(),h("svg",Y,[Z])}A.render=x;A.__file="packages/components/Delete.vue";var ee=A,V=D({name:"Plus"});const ae={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},te=s("path",{fill:"currentColor",d:"M480 480V128a32 32 0 0 1 64 0v352h352a32 32 0 1 1 0 64H544v352a32 32 0 1 1-64 0V544H128a32 32 0 0 1 0-64h352z"},null,-1);function oe(e,a,r,l,m,i){return f(),h("svg",ae,[te])}V.render=oe;V.__file="packages/components/Plus.vue";var le=V,T=D({name:"Search"});const ne={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},se=s("path",{fill:"currentColor",d:"m795.904 750.72 124.992 124.928a32 32 0 0 1-45.248 45.248L750.656 795.904a416 416 0 1 1 45.248-45.248zM480 832a352 352 0 1 0 0-704 352 352 0 0 0 0 704z"},null,-1);function re(e,a,r,l,m,i){return f(),h("svg",ne,[se])}T.render=re;T.__file="packages/components/Search.vue";var ue=T;const ie=D({props:{data:{type:Array,default:()=>[]},select:{type:Array,default:()=>[]},showIndex:{type:Boolean,default:!1},showSelection:{type:Boolean,default:!1},showPage:{type:Boolean,default:!0},page:{type:Object,default:()=>({index:1,size:20,total:0})},pageLayout:{type:String,default:"total, sizes, prev, pager, next, jumper"},pageSizes:{type:Array,default:[10,20,50,100]}},setup(e,a){const r=y(null);let l=null;const m=o=>{l?e.page.index=1:(e.page.index=o,a.emit("getTableData"))},i=o=>{l="work",setTimeout(()=>{l=null},100),e.page.size=o,a.emit("getTableData",!0)},p=o=>{a.emit("selection-change",o)};return H(()=>{r.value.doLayout()}),{table:r,handleCurrentChange:m,handleSizeChange:i,handleSelectionChange:p}}}),de={class:"system-table-box"};function pe(e,a,r,l,m,i){const p=c("el-table-column"),o=c("el-table");return f(),F("div",de,[s(o,U(e.$attrs,{ref:"table",class:"system-table",border:"",height:"100%",data:e.data,onSelectionChange:e.handleSelectionChange}),{default:d(()=>[e.showIndex?(f(),h(p,{key:0,label:"\u5E8F\u53F7",width:"60",align:"center"},{default:d(_=>[$(w((e.page.index-1)*e.page.size+_.$index+1),1)]),_:1})):P("",!0),M(e.$slots,"default",{},void 0,!0)]),_:3},16,["data","onSelectionChange"])])}var ce=S(ie,[["render",pe],["__scopeId","data-v-75a64faf"]]);const me=[{value:2,label:"\u7BA1\u7406\u5458"},{value:3,label:"\u5F85\u5BA1\u6279\u7BA1\u7406\u5458"}],fe=D({components:{Layer:j},props:{layer:{type:Object,default:()=>({show:!1,title:"",showButton:!0,staff_id:""})}},setup(e,a){const r=I(),l=y(null),m=y(null);let i=y({staff_id:"",department_id:"",type:"",needUpdate:!1}),p=y([{}]);const o={staff_id:[{required:!0,message:"\u8BF7\u8F93\u5165\u7BA1\u7406\u5458\u5DE5\u53F7",trigger:"blur"}],department_id:[{required:!0,message:"\u8BF7\u9009\u62E9",trigger:"blur"}],type:[{required:!0,message:"\u8BF7\u9009\u62E9",trigger:"blur"}]};_();function _(){e.layer.row&&(i.value=JSON.parse(JSON.stringify(e.layer.row)),i.value.needUpdate=i.value.staff_id==r.state.user.info.staff_id)}return(b=>{W(),X().then(g=>{console.log(g);let n=[];for(const u in g.data){if(!g.data.hasOwnProperty(u))continue;const t={label:g.data[u].name,value:g.data[u].id};n.push(t)}p.value=n}).catch(g=>{O()}).finally(()=>{O()})})(),{form:i,rules:o,layerDom:m,ruleForm:l,selectData:p,radioData:me}},methods:{submit(){this.ruleForm&&this.ruleForm.validate(e=>{if(e){let a=this.form;this.layer.row?this.updateForm(a):this.addForm(a)}else return!1})},addForm(e){console.log(e),q(e).then(a=>{this.$message({type:"success",message:"\u65B0\u589E\u6210\u529F"}),this.$emit("getTableData",!0),this.layerDom&&this.layerDom.close()})},updateForm(e){G(e).then(a=>{this.$message({type:"success",message:"\u7F16\u8F91\u6210\u529F"}),this.$emit("getTableData",!1),this.layerDom&&this.layerDom.close()})}}});function ge(e,a,r,l,m,i){const p=c("el-input"),o=c("el-form-item"),_=c("el-option"),v=c("el-select"),b=c("el-radio"),g=c("el-radio-group"),n=c("el-form"),u=c("Layer",!0);return f(),h(u,{layer:e.layer,onConfirm:e.submit,ref:"layerDom"},{default:d(()=>[s(n,{model:e.form,rules:e.rules,ref:"ruleForm","label-width":"120px",style:{"margin-right":"30px"}},{default:d(()=>[s(o,{label:"\u7BA1\u7406\u5458\u5DE5\u53F7\uFF1A",prop:"staff_id"},{default:d(()=>[s(p,{modelValue:e.form.staff_id,"onUpdate:modelValue":a[0]||(a[0]=t=>e.form.staff_id=t),placeholder:"\u8BF7\u8F93\u5165\u5DE5\u53F7"},null,8,["modelValue"])]),_:1}),s(o,{label:"\u6240\u5C5E\u90E8\u95E8\uFF1A",prop:"select"},{default:d(()=>[s(v,{modelValue:e.form.department_id,"onUpdate:modelValue":a[1]||(a[1]=t=>e.form.department_id=t),placeholder:"\u8BF7\u9009\u62E9",clearable:""},{default:d(()=>[(f(!0),F(z,null,L(e.selectData,t=>(f(),h(_,{key:t.value,label:t.label,value:t.value},{default:d(()=>[$(w(t.label),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(o,{label:"\u7C7B\u578B\uFF1A",prop:"radio"},{default:d(()=>[s(g,{modelValue:e.form.type,"onUpdate:modelValue":a[2]||(a[2]=t=>e.form.type=t)},{default:d(()=>[(f(!0),F(z,null,L(e.radioData,t=>(f(),h(b,{key:t.value,label:t.value},{default:d(()=>[$(w(t.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["layer","onConfirm"])}var _e=S(fe,[["render",ge]]);const he=D({name:"crudTable",components:{Table:ce,Layer:_e},setup(){const e=I(),a=B({input:""}),r=B({show:!1,title:"\u65B0\u589E",showButton:!0}),l=B({index:1,size:20,total:0}),m=y(!0),i=y([]),p=y([]),o=n=>{p.value=n},_=n=>{m.value=!0,n&&(l.index=1),{page:l.index,pageSize:l.size,...a},R().then(u=>{u.data.list;let t=[];for(const k in u.data.list){if(!u.data.list.hasOwnProperty(k))continue;const N=u.data.list[k];t.push(N)}i.value=t,l.total=Number(u.data.pager.total)}).catch(u=>{i.value=[],l.index=1,l.total=0}).finally(()=>{m.value=!1})},v=n=>{let u={staff_id:n.map(t=>t.staff_id).join(",")};console.log(u),u.staff_id==e.state.user.info.staff_id?E({type:"warning",message:"\u4E0D\u53EF\u5220\u9664\u81EA\u5DF1\uFF01"}):Q(u).then(t=>{E({type:"success",message:"\u5220\u9664\u6210\u529F"}),_(i.value.length===1)})},b=()=>{r.title="\u65B0\u589E\u7BA1\u7406\u5458",r.show=!0,delete r.row},g=n=>{console.log(n),n.staff_id==e.state.user.info.staff_id?E({type:"warning",message:"\u65E0\u6743\u9650\uFF01"}):(r.title="\u7F16\u8F91\u7BA1\u7406\u5458",r.row=n,r.show=!0)};return _(!0),{Plus:le,Search:ue,Delete:ee,query:a,tableData:i,chooseData:p,loading:m,page:l,layer:r,handleSelectionChange:o,handleAdd:b,handleEdit:g,handleDel:v,getTableData:_}}}),ye={class:"layout-container"},ve={class:"layout-container-form flex space-between"},be={class:"layout-container-form-handle"},$e={class:"layout-container-table"};function we(e,a,r,l,m,i){const p=c("el-button"),o=c("el-table-column"),_=c("el-popconfirm"),v=c("Table"),b=c("Layer"),g=J("loading");return f(),F("div",ye,[C("div",ve,[C("div",be,[s(p,{type:"primary",icon:e.Plus,onClick:e.handleAdd},{default:d(()=>[$(w(e.$t("message.common.add")),1)]),_:1},8,["icon","onClick"])])]),C("div",$e,[K((f(),h(v,{ref:"table",page:e.page,"onUpdate:page":a[0]||(a[0]=n=>e.page=n),showIndex:!0,showSelection:!0,data:e.tableData,onGetTableData:e.getTableData,onSelectionChange:e.handleSelectionChange},{default:d(()=>[s(o,{prop:"staff_id",label:"\u5DE5\u53F7",align:"center"}),s(o,{prop:"type_name",label:"\u7C7B\u578B",align:"center"}),s(o,{prop:"department_name",label:"\u90E8\u95E8\u6240\u5C5E",align:"center"}),s(o,{label:e.$t("message.common.handle"),align:"center",fixed:"right",width:"200"},{default:d(n=>[s(p,{onClick:u=>e.handleEdit(n.row)},{default:d(()=>[$(w(e.$t("message.common.update")),1)]),_:2},1032,["onClick"]),s(_,{title:e.$t("message.common.delTip"),onConfirm:u=>e.handleDel([n.row])},{reference:d(()=>[s(p,{type:"danger"},{default:d(()=>[$(w(e.$t("message.common.del")),1)]),_:1})]),_:2},1032,["title","onConfirm"])]),_:1},8,["label"])]),_:1},8,["page","data","onGetTableData","onSelectionChange"])),[[g,e.loading]]),e.layer.show?(f(),h(b,{key:0,layer:e.layer,onGetTableData:e.getTableData},null,8,["layer","onGetTableData"])):P("",!0)])])}var Ee=S(he,[["render",we]]);export{Ee as default};
